<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="LightningDB Team">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Data Ingestion and querying - LightningDB Docs</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Data Ingestion and querying";
    var mkdocs_page_input_path = "data-ingestion-and-querying.md";
    var mkdocs_page_url = "/docs/data-ingestion-and-querying/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-152587413-1', 'mnms.github.io/docs');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> LightningDB Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">Introduction</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="..">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../release-note/">Release Notes</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Getting Started</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../prerequisite/">Prerequisite</a>
                </li>
                <li class="">
                    
    <a class="" href="../install-fbctl/">Installation</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tutorial</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../try-with-zeppelin/">Try out with Zeppelin</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Interface</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../command-line-interface/">Command Line</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Data Ingestion and querying</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#1-create-a-table">1. Create a table</a></li>
    

    <li class="toctree-l3"><a href="#2-data-ingestion">2. Data Ingestion</a></li>
    

    <li class="toctree-l3"><a href="#3-querying">3. Querying</a></li>
    

    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Operation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../version-update/">Version update</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Additional Resources</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../get-started-with-scratch/">Manual Installation</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">LightningDB Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Interface &raquo;</li>
        
      
    
    <li>Data Ingestion and querying</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/mnms/docs/edit/master/docs/data-ingestion-and-querying.md"> Edit on source repository</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="1-create-a-table">1. Create a table<a class="headerlink" href="#1-create-a-table" title="Permanent link">&para;</a></h1>
<p>You can create tables in the metastore using standard DDL.</p>
<pre><code>CREATE TABLE `pcell` (
    `event_time` STRING,
    `m_10_under` DOUBLE,
    `m_10_19` DOUBLE,
    `m_20_29` DOUBLE,
    `m_30_39` DOUBLE,
    `m_40_49` DOUBLE,
    `m_50_59` DOUBLE,
    `m_60_over` DOUBLE,
    `longitude` DOUBLE,
    `lattitude` DOUBLE,
    `geohash` STRING)
USING r2
OPTIONS (
  `table` '100',
  `host` 'localhost',
  `port` '18100',
  `partitions` 'event_time geohash',
  `mode` 'nvkvs',
  `at_least_one_partition_enabled` 'no',
  `rowstore` 'true'
  )
</code></pre>

<p>There are various options used to describe storage properties.</p>
<ul>
<li>table : Positive Integer. The identification of table. Redis indentifies a table with this value.</li>
<li>host/port : The host/port of representative Redis Node. Using this host and port, Spark builds a Redis cluster client that retrieves and inserts data to the Redis cluster.</li>
<li>partitions : The partitions columns. The partition column values are used to distribute data in Redis cluster. That is, the partition column values are concatenated with a colon(:) and used as KEY of Redis which is the criteria distributing data. For more information, you can refer <a href="https://redis.io/topics/cluster-spec#keys-distribution-model">Keys distribution model page</a> in Redis.</li>
</ul>
<p>!!!Tip
        Deciding a partition column properly is a crucial factor for performance because it is related to sharding data to multiple Redis nodes. It is important to try distribute KEYs to 16384 slots of REDIS evenly and to try to map at least 200 rows for each KEYs.</p>
<ul>
<li>mode : 'nvkvs' for this field</li>
<li>at_least_one_partition_enabled : yes or no. If yes, the queries which do not have partition filter are not permitted.</li>
<li>rowstore : true or false. If yes, all columns are merged and stored in RockDB as one column. It enhances ingesting performance. However, the query performance can be dropped because there is overhead for parsing columns in Redis layer when retrieving data from RockDB.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The metastore of LightningDB only contains metadata / schema of tables.
The actual data are stored in FlashBase which consists of Redis &amp; RockDB (Abbreviation : r2), and the table information is stored in metastore.</p>
</div>
<h1 id="2-data-ingestion">2. Data Ingestion<a class="headerlink" href="#2-data-ingestion" title="Permanent link">&para;</a></h1>
<p><strong>(1) Insert data with DataFrameWriter</strong></p>
<p>You can use DataFrameWriter to write data into LightningDB.</p>
<p>Now, LightingDB only supports "<a href="https://spark.apache.org/docs/2.3.1/api/java/org/apache/spark/sql/SaveMode.html#Append">Append mode</a>".</p>
<pre><code class="scala">// Create source DataFrame.
val df = spark.sqlContext.read.format(&quot;csv&quot;)
    .option(&quot;header&quot;, &quot;false&quot;)
    .option(&quot;inferSchema&quot;, &quot;true&quot;)
    .load(&quot;/nvme/data_01/csv/&quot;)

// &quot;pcell&quot; is a name of table which has R2 options.
df.write.insertInto(&quot;pcell&quot;)
</code></pre>

<p><strong>(2) Insert data with INSERT INTO SELECT query</strong></p>
<pre><code class="sql">-- pcell : table with R2 option
-- csv_table : table with csv option
-- udf : UDF can be used to tranform original data.
INSERT INTO pcell SELECT *, udf(event_time) FROM csv_table
</code></pre>

<h1 id="3-querying">3. Querying<a class="headerlink" href="#3-querying" title="Permanent link">&para;</a></h1>
<p>You can query data with SparkSQL interface such as DataFrames and Spark ThriftServer.
Please refer to <a href="https://spark.apache.org/docs/latest/api/sql/index.html">Spark SQL guide page</a>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../version-update/" class="btn btn-neutral float-right" title="Version update">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../command-line-interface/" class="btn btn-neutral" title="Command Line"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>All right reserved, LightningDB Team.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../command-line-interface/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../version-update/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
