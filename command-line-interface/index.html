<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="LightningDB Team">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Commands - LightningDB Docs</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Commands";
    var mkdocs_page_input_path = "command-line-interface.md";
    var mkdocs_page_url = "/docs/command-line-interface/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-152587413-1', 'mnms.github.io/docs');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> LightningDB Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Get Started</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../get-started-with-aws/">Automated Installation (recommended)</a>
                </li>
                <li class="">
                    
    <a class="" href="../get-started-with-scratch/">Manual Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../try-with-zeppelin/">Try out with Zeppelin</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">FBCTL</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../run-and-deploy-fbctl/">Install and Upgrade</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Commands</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#1-cluster-commands">1. Cluster Commands</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#1-cluster-configure">(1) cluster configure</a></li>
        
            <li><a class="toctree-l4" href="#2-cluster-start">(2) cluster start</a></li>
        
            <li><a class="toctree-l4" href="#3-cluster-create">(3) cluster create</a></li>
        
            <li><a class="toctree-l4" href="#4-cluster-stop">(4) cluster stop</a></li>
        
            <li><a class="toctree-l4" href="#5-cluster-clean">(5) cluster clean</a></li>
        
            <li><a class="toctree-l4" href="#6-cluster-restart">(6) cluster restart​</a></li>
        
            <li><a class="toctree-l4" href="#7-check-cluster-infos">(7) Check Cluster Infos</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../data-ingestion-and-querying/">Data Ingestion and Querying</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../release-note/">Release Notes</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">LightningDB Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>FBCTL &raquo;</li>
        
      
    
    <li>Commands</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/mnms/docs/edit/master/docs/command-line-interface.md"> Edit on source repository</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="1-cluster-commands">1. Cluster Commands<a class="headerlink" href="#1-cluster-commands" title="Permanent link">&para;</a></h1>
<p>If you want to see the list of cluster commands, use the 'cluster' command without any option.</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; cluster

NAME
    fbctl cluster - This is cluster command

SYNOPSIS
    fbctl cluster COMMAND

DESCRIPTION
    This is cluster command

COMMANDS
    COMMAND is one of the following:

     add_slave
       Add slaves to cluster additionally

     clean
       Clean cluster

     configure

     create
       Create cluster

     ls
       Check cluster list

     rebalance
       Rebalance

     restart
       Restart redist cluster

     rowcount
       Query and show cluster row count

     start
       Start cluster

     stop
       Stop cluster

     use
       Change selected cluster
</code></pre>

<h2 id="1-cluster-configure">(1) cluster configure<a class="headerlink" href="#1-cluster-configure" title="Permanent link">&para;</a></h2>
<p>redis-{port}.conf is generated with using redis-{master/slave}.conf.template and redis.properties.</p>
<pre><code class="bash">&gt; cluster configure
</code></pre>

<h2 id="2-cluster-start">(2) cluster start<a class="headerlink" href="#2-cluster-start" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Backup logs of the previous master/slave nodes</p>
<ul>
<li>All log files of previous master/slave nodes in '${SR2_HOME}<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>/logs/redis/' will be moved to '${SR2_HOME}/logs/redis/backup/'.</li>
</ul>
</li>
<li>
<p>Generate directories to save data</p>
<ul>
<li>Save aof and rdb files of redis-server and RocksDB files in '${SR2_REDIS_DATA}'</li>
</ul>
</li>
<li>
<p>Start redis-server process</p>
<ul>
<li>Start master and slave redis-server with '${SR2_HOME}/conf/redis/redis-{port}.conf' file</li>
</ul>
</li>
<li>Log files will be saved in '${SR2_HOME}/logs/redis/'</li>
</ul>
<pre><code class="bash">ec2-user@flashbase:1&gt; cluster start
Check status of hosts...
OK
Check cluster exist...
 - 127.0.0.1
OK
Backup redis master log in each MASTER hosts...
 - 127.0.0.1
Generate redis configuration files for master hosts
sync conf
+-----------+--------+
| HOST      | STATUS |
+-----------+--------+
| 127.0.0.1 | OK     |
+-----------+--------+
Starting master nodes : 127.0.0.1 : 18100|18101|18102|18103|18104 ...
Wait until all redis process up...
cur: 5 / total: 5
Complete all redis process up
</code></pre>

<p><strong>Errors</strong></p>
<ul>
<li>ErrorCode 11</li>
</ul>
<p>Redis-server(master) process with same port is already running. To resolve this error, use 'cluster stop' or 'kill {pid of the process}'.</p>
<pre><code class="bash">$ cluster start
...
...
[ErrorCode 11] Fail to start... Must be checked running MASTER redis processes!
We estimate that redis process is &lt;alive-redis-count&gt;.
</code></pre>

<ul>
<li>ErrorCode 12</li>
</ul>
<p>Redis-server(slave) process with same port is already running. To resolve this error, use 'cluster stop' or 'kill {pid of the process}'.</p>
<pre><code class="bash">$ cluster start
...
[ErrorCode 12] Fail to start... Must be checked running SLAVE redis processes!
We estimate that redis process is &lt;alive-redis-count&gt;.
</code></pre>

<ul>
<li>Conf file not exist</li>
</ul>
<p>Conf file is not found. To resove this error, use 'cluster configure' and then 'cluster start'.
cluster configure 명령어를 실행시킨 후 cluster start를 진행하세요.</p>
<pre><code class="bash">$ cluster start
...
FileNotExistError: ${SR2_HOME}/conf/redis/redis-{port}.conf
</code></pre>

<ul>
<li>max try error
​
For detail information, please check log files.</li>
</ul>
<pre><code class="bash">$ cluster start
...
max try error
</code></pre>

<h2 id="3-cluster-create">(3) cluster create<a class="headerlink" href="#3-cluster-create" title="Permanent link">&para;</a></h2>
<p>After checking information of the cluster, create cluster of LightningDB.</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; cluster create
Check status of hosts...
OK
&gt;&gt;&gt; Creating cluster
+-----------+-------+--------+
| HOST      | PORT  | TYPE   |
+-----------+-------+--------+
| 127.0.0.1 | 18100 | MASTER |
| 127.0.0.1 | 18101 | MASTER |
| 127.0.0.1 | 18102 | MASTER |
| 127.0.0.1 | 18103 | MASTER |
| 127.0.0.1 | 18104 | MASTER |
+-----------+-------+--------+
replicas: 0

Do you want to proceed with the create according to the above information? (y/n)
y
Cluster meet...
 - 127.0.0.1:18100
 - 127.0.0.1:18103
 - 127.0.0.1:18104
 - 127.0.0.1:18101
 - 127.0.0.1:18102
Adding slots...
 - 127.0.0.1:18100, 3280
 - 127.0.0.1:18103, 3276
 - 127.0.0.1:18104, 3276
 - 127.0.0.1:18101, 3276
 - 127.0.0.1:18102, 3276
Check cluster state and asign slot...
Ok
create cluster complete.
</code></pre>

<p><strong>Errors</strong></p>
<p>When redis servers are not running, this error(Errno 111) will occur. To solve this error, use 'cluster start' command previously.</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; cluster create
Check status of hosts...
OK
&gt;&gt;&gt; Creating cluster
+-----------+-------+--------+
| HOST      | PORT  | TYPE   |
+-----------+-------+--------+
| 127.0.0.1 | 18100 | MASTER |
| 127.0.0.1 | 18101 | MASTER |
| 127.0.0.1 | 18102 | MASTER |
| 127.0.0.1 | 18103 | MASTER |
| 127.0.0.1 | 18104 | MASTER |
+-----------+-------+--------+
replicas: 0

Do you want to proceed with the create according to the above information? (y/n)
y
127.0.0.1:18100 - [Errno 111] Connection refused
</code></pre>

<p>​​</p>
<h2 id="4-cluster-stop">(4) cluster stop<a class="headerlink" href="#4-cluster-stop" title="Permanent link">&para;</a></h2>
<p>​Gracefully kill all redis-servers(master/slave) with SIGINT
​​</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; cluster stop
Check status of hosts...
OK
Stopping master cluster of redis...
cur: 5 / total: 5
cur: 0 / total: 5
Complete all redis process down
</code></pre>

<p><strong>Options</strong></p>
<ul>
<li>Force to kill all redis-servers(master/slave) with SIGKILL</li>
</ul>
<pre><code class="bash">--force
</code></pre>

<h2 id="5-cluster-clean">(5) cluster clean<a class="headerlink" href="#5-cluster-clean" title="Permanent link">&para;</a></h2>
<p>Remove conf files for redis-server and all data(aof, rdb, RocksDB) of LightningDB</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; cluster clean
Removing redis generated master configuration files
 - 127.0.0.1
Removing flash db directory, appendonly and dump.rdb files in master
 - 127.0.0.1
Removing master node configuration
 - 127.0.0.1
</code></pre>

<h2 id="6-cluster-restart">(6) cluster restart​<a class="headerlink" href="#6-cluster-restart" title="Permanent link">&para;</a></h2>
<p>Process 'cluster stop' and then 'cluster start'.​​</p>
<p><strong>Options</strong></p>
<ul>
<li>Force to kill all redis-servers(master/slave) with SIGKILL and then start again.</li>
</ul>
<pre><code class="bash">--force-stop
</code></pre>

<ul>
<li>Remove all data(aof, rdb, RocksDB, conf files) before start again.</li>
</ul>
<pre><code class="bash">--reset
</code></pre>

<ul>
<li>Process 'cluster create'. This command should be called with '--reset'.</li>
</ul>
<pre><code class="bash">--cluster
</code></pre>

<h2 id="7-check-cluster-infos">(7) Check Cluster Infos<a class="headerlink" href="#7-check-cluster-infos" title="Permanent link">&para;</a></h2>
<p>With the following commands, you can check the status of the cluster.</p>
<ul>
<li>Send PING</li>
</ul>
<pre><code class="bash">&gt; cli ping --all
</code></pre>

<ul>
<li>Check the status of the cluster</li>
</ul>
<pre><code class="bash">&gt; cli cluster info
</code></pre>

<ul>
<li>Check the list of the nodes those are organizing the cluster.</li>
</ul>
<pre><code class="bash">ec2-user@flashbase:1&gt; cli cluster nodes
559af5e90c3f2c92f19c927c29166c268d938e8f 127.0.0.1:18104 master - 0 1574127926000 4 connected 6556-9831
174e2a62722273fb83814c2f12e2769086c3d185 127.0.0.1:18101 myself,master - 0 1574127925000 3 connected 9832-13107
35ab4d3f7f487c5332d7943dbf4b20d5840053ea 127.0.0.1:18100 master - 0 1574127926000 1 connected 0-3279
f39ed05ace18e97f74c745636ea1d171ac1d456f 127.0.0.1:18103 master - 0 1574127927172 0 connected 3280-6555
9fd612b86a9ce1b647ba9170b8f4a8bfa5c875fc 127.0.0.1:18102 master - 0 1574127926171 2 connected 13108-16383
</code></pre>

<p>​</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>If user types 'cfc 1', ${SR2_HOME} will be '~/tsr2/cluster_1/tsr2-assembly-1.0.0-SNAPSHOT'.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../data-ingestion-and-querying/" class="btn btn-neutral float-right" title="Data Ingestion and Querying">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../run-and-deploy-fbctl/" class="btn btn-neutral" title="Install and Upgrade"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>All right reserved, LightningDB Team.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../run-and-deploy-fbctl/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../data-ingestion-and-querying/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
