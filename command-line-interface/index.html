<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="LightningDB Team">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Command Line - LightningDB Docs</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Command Line";
    var mkdocs_page_input_path = "command-line-interface.md";
    var mkdocs_page_url = "/docs/command-line-interface/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-152587413-1', 'mnms.github.io/docs');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> LightningDB Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">Introduction</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="..">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../release-note/">Release Notes</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Getting Started</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../prerequisite/">Prerequisite</a>
                </li>
                <li class="">
                    
    <a class="" href="../install-fbctl/">Installation</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tutorial</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../try-with-zeppelin/">Try out with Zeppelin</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Interface</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="./">Command Line</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#1-cluster-commands">1. Cluster Commands</a></li>
    

    <li class="toctree-l3"><a href="#2-thrift-server-commands">2. Thrift Server Commands</a></li>
    

    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Operation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../version-update/">Version update</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Additional Resources</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../get-started-with-scratch/">Manual Installation</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">LightningDB Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Interface &raquo;</li>
        
      
    
    <li>Command Line</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/mnms/docs/edit/master/docs/command-line-interface.md"> Edit on source repository</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <div class="admonition note">
<p class="admonition-title">Note</p>
<p>Command Line Interface(CLI) of LightningDB supports not only deploy and start command but also many commands to access and manipulate data in LightningDB.</p>
</div>
<h1 id="1-cluster-commands">1. Cluster Commands<a class="headerlink" href="#1-cluster-commands" title="Permanent link">&para;</a></h1>
<p>If you want to see the list of cluster commands, use the 'cluster' command without any option.</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; cluster

NAME
    fbctl cluster - This is cluster command

SYNOPSIS
    fbctl cluster COMMAND

DESCRIPTION
    This is cluster command

COMMANDS
    COMMAND is one of the following:

     add_slave
       Add slaves to cluster additionally

     clean
       Clean cluster

     configure

     create
       Create cluster

     ls
       Check cluster list

     rebalance
       Rebalance

     restart
       Restart redist cluster

     rowcount
       Query and show cluster row count

     start
       Start cluster

     stop
       Stop cluster

     use
       Change selected cluster
</code></pre>

<p><strong>(1) cluster configure</strong></p>
<p>redis-{port}.conf is generated with using redis-{master/slave}.conf.template and redis.properties.</p>
<pre><code class="bash">&gt; cluster configure
</code></pre>

<p><strong>(2) cluster start</strong></p>
<ul>
<li>
<p>Backup logs of the previous master/slave nodes</p>
<ul>
<li>All log files of previous master/slave nodes in '${SR2_HOME}<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>/logs/redis/' will be moved to '${SR2_HOME}/logs/redis/backup/'.</li>
</ul>
</li>
<li>
<p>Generate directories to save data</p>
<ul>
<li>Save aof and rdb files of redis-server and RocksDB files in '${SR2_REDIS_DATA}'</li>
</ul>
</li>
<li>
<p>Start redis-server process</p>
<ul>
<li>Start master and slave redis-server with '${SR2_HOME}/conf/redis/redis-{port}.conf' file</li>
</ul>
</li>
<li>Log files will be saved in '${SR2_HOME}/logs/redis/'</li>
</ul>
<pre><code class="bash">ec2-user@flashbase:1&gt; cluster start
Check status of hosts...
OK
Check cluster exist...
 - 127.0.0.1
OK
Backup redis master log in each MASTER hosts...
 - 127.0.0.1
Generate redis configuration files for master hosts
sync conf
+-----------+--------+
| HOST      | STATUS |
+-----------+--------+
| 127.0.0.1 | OK     |
+-----------+--------+
Starting master nodes : 127.0.0.1 : 18100|18101|18102|18103|18104 ...
Wait until all redis process up...
cur: 5 / total: 5
Complete all redis process up
</code></pre>

<p><strong>Errors</strong></p>
<ul>
<li>ErrorCode 11</li>
</ul>
<p>Redis-server(master) process with same port is already running. To resolve this error, use 'cluster stop' or 'kill {pid of the process}'.</p>
<pre><code class="bash">$ cluster start
...
...
[ErrorCode 11] Fail to start... Must be checked running MASTER redis processes!
We estimate that redis process is &lt;alive-redis-count&gt;.
</code></pre>

<ul>
<li>ErrorCode 12</li>
</ul>
<p>Redis-server(slave) process with same port is already running. To resolve this error, use 'cluster stop' or 'kill {pid of the process}'.</p>
<pre><code class="bash">$ cluster start
...
[ErrorCode 12] Fail to start... Must be checked running SLAVE redis processes!
We estimate that redis process is &lt;alive-redis-count&gt;.
</code></pre>

<ul>
<li>Conf file not exist</li>
</ul>
<p>Conf file is not found. To resove this error, use 'cluster configure' and then 'cluster start'.
cluster configure 명령어를 실행시킨 후 cluster start를 진행하세요.</p>
<pre><code class="bash">$ cluster start
...
FileNotExistError: ${SR2_HOME}/conf/redis/redis-{port}.conf
</code></pre>

<ul>
<li>max try error
​
For detail information, please check log files.</li>
</ul>
<pre><code class="bash">$ cluster start
...
max try error
</code></pre>

<p><strong>(3) cluster create</strong></p>
<p>After checking information of the cluster, create cluster of LightningDB.</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; cluster create
Check status of hosts...
OK
&gt;&gt;&gt; Creating cluster
+-----------+-------+--------+
| HOST      | PORT  | TYPE   |
+-----------+-------+--------+
| 127.0.0.1 | 18100 | MASTER |
| 127.0.0.1 | 18101 | MASTER |
| 127.0.0.1 | 18102 | MASTER |
| 127.0.0.1 | 18103 | MASTER |
| 127.0.0.1 | 18104 | MASTER |
+-----------+-------+--------+
replicas: 0

Do you want to proceed with the create according to the above information? (y/n)
y
Cluster meet...
 - 127.0.0.1:18100
 - 127.0.0.1:18103
 - 127.0.0.1:18104
 - 127.0.0.1:18101
 - 127.0.0.1:18102
Adding slots...
 - 127.0.0.1:18100, 3280
 - 127.0.0.1:18103, 3276
 - 127.0.0.1:18104, 3276
 - 127.0.0.1:18101, 3276
 - 127.0.0.1:18102, 3276
Check cluster state and asign slot...
Ok
create cluster complete.
</code></pre>

<p><strong>Errors</strong></p>
<p>When redis servers are not running, this error(Errno 111) will occur. To solve this error, use 'cluster start' command previously.</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; cluster create
Check status of hosts...
OK
&gt;&gt;&gt; Creating cluster
+-----------+-------+--------+
| HOST      | PORT  | TYPE   |
+-----------+-------+--------+
| 127.0.0.1 | 18100 | MASTER |
| 127.0.0.1 | 18101 | MASTER |
| 127.0.0.1 | 18102 | MASTER |
| 127.0.0.1 | 18103 | MASTER |
| 127.0.0.1 | 18104 | MASTER |
+-----------+-------+--------+
replicas: 0

Do you want to proceed with the create according to the above information? (y/n)
y
127.0.0.1:18100 - [Errno 111] Connection refused
</code></pre>

<p>​​
<strong>(4) cluster stop</strong></p>
<p>​Gracefully kill all redis-servers(master/slave) with SIGINT
​​</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; cluster stop
Check status of hosts...
OK
Stopping master cluster of redis...
cur: 5 / total: 5
cur: 0 / total: 5
Complete all redis process down
</code></pre>

<p><strong>Options</strong></p>
<ul>
<li>Force to kill all redis-servers(master/slave) with SIGKILL</li>
</ul>
<pre><code class="bash">--force
</code></pre>

<p><strong>(5) cluster clean</strong></p>
<p>Remove conf files for redis-server and all data(aof, rdb, RocksDB) of LightningDB</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; cluster clean
Removing redis generated master configuration files
 - 127.0.0.1
Removing flash db directory, appendonly and dump.rdb files in master
 - 127.0.0.1
Removing master node configuration
 - 127.0.0.1
</code></pre>

<p><strong>(6) cluster restart​</strong></p>
<p>Process 'cluster stop' and then 'cluster start'.​​</p>
<p><strong>Options</strong></p>
<ul>
<li>Force to kill all redis-servers(master/slave) with SIGKILL and then start again.</li>
</ul>
<pre><code class="bash">--force-stop
</code></pre>

<ul>
<li>Remove all data(aof, rdb, RocksDB, conf files) before start again.</li>
</ul>
<pre><code class="bash">--reset
</code></pre>

<ul>
<li>Process 'cluster create'. This command should be called with '--reset'.</li>
</ul>
<pre><code class="bash">--cluster
</code></pre>

<p><strong>(7) cluster ls</strong></p>
<p>List up the deployed clusters.</p>
<pre><code class="bash">ec2-user@flashbase:2&gt; cluster ls
[1, 2]
</code></pre>

<p><strong>(8) cluster use</strong></p>
<p>Change the cluster to use FBCTL. Use 'cluster use' or 'c' commands.</p>
<pre><code class="bash">ec2-user@flashbase:2&gt; cluster use 1
Cluster '1' selected.
ec2-user@flashbase:1&gt; c 2
Cluster '2' selected.
</code></pre>

<p><strong>(9) cluster add_slave</strong></p>
<p>You can add a slave to a cluster that is configured only with master without redundancy.</p>
<ul>
<li>
<p>create cluster only with master</p>
<ul>
<li>Procedure for configuring the test environment. If cluster with only master already exists, go to the <strong>add slave info</strong>.</li>
</ul>
</li>
<li>
<p>Proceed with the deploy.</p>
<ul>
<li>Enter 0 in replicas as shown below when deploy.</li>
</ul>
</li>
</ul>
<pre><code class="bash">ec2-user@flashbase:2&gt; deploy 3
Select installer

    [ INSTALLER LIST ]
    (1) flashbase.dev.master.5a6a38.bin

Please enter the number, file path or url of the installer you want to use.
you can also add file in list by copy to '$FBPATH/releases/'
https://flashbase.s3.ap-northeast-2.amazonaws.com/flashbase.dev.master.5a6a38.bin
Downloading flashbase.dev.master.5a6a38.bin
[==================================================] 100%
OK, flashbase.dev.master.5a6a38.bin
Please type host list separated by comma(,) [127.0.0.1]

OK, ['127.0.0.1']
How many masters would you like to create on each host? [5]

OK, 5
Please type ports separate with comma(,) and use hyphen(-) for range. [18300-18304]

OK, ['18300-18304']
How many replicas would you like to create on each master? [0]

OK, 0
How many ssd would you like to use? [3]

OK, 3
Type prefix of db path [~/sata_ssd/ssd_]

OK, ~/sata_ssd/ssd_
+--------------+---------------------------------+
| NAME         | VALUE                           |
+--------------+---------------------------------+
| installer    | flashbase.dev.master.5a6a38.bin |
| hosts        | 127.0.0.1                       |
| master ports | 18300-18304                     |
| ssd count    | 3                               |
| db path      | ~/sata_ssd/ssd_                 |
+--------------+---------------------------------+
Do you want to proceed with the deploy accroding to the above information? (y/n)
y
Check status of hosts...
+-----------+--------+
| HOST      | STATUS |
+-----------+--------+
| 127.0.0.1 | OK     |
+-----------+--------+
OK
Checking for cluster exist...
+-----------+--------+
| HOST      | STATUS |
+-----------+--------+
| 127.0.0.1 | CLEAN  |
+-----------+--------+
OK
Transfer installer and execute...
 - 127.0.0.1
Sync conf...
Complete to deploy cluster 3.
Cluster '3' selected.
</code></pre>

<ul>
<li>When the deploy is complete, start and create the cluster.</li>
</ul>
<pre><code class="bash">ec2-user@flashbase:3&gt; cluster start
Check status of hosts...
OK
Check cluster exist...
 - 127.0.0.1
OK
Backup redis master log in each MASTER hosts...
 - 127.0.0.1
create redis data directory in each MASTER hosts
 - 127.0.0.1
sync conf
+-----------+--------+
| HOST      | STATUS |
+-----------+--------+
| 127.0.0.1 | OK     |
+-----------+--------+
OK
Starting master nodes : 127.0.0.1 : 18300|18301|18302|18303|18304 ...
Wait until all redis process up...
cur: 5 / total: 5
Complete all redis process up
ec2-user@flashbase:3&gt; cluster create
Check status of hosts...
OK
&gt;&gt;&gt; Creating cluster
+-----------+-------+--------+
| HOST      | PORT  | TYPE   |
+-----------+-------+--------+
| 127.0.0.1 | 18300 | MASTER |
| 127.0.0.1 | 18301 | MASTER |
| 127.0.0.1 | 18302 | MASTER |
| 127.0.0.1 | 18303 | MASTER |
| 127.0.0.1 | 18304 | MASTER |
+-----------+-------+--------+
replicas: 0

Do you want to proceed with the create according to the above information? (y/n)
y
Cluster meet...
 - 127.0.0.1:18300
 - 127.0.0.1:18303
 - 127.0.0.1:18304
 - 127.0.0.1:18301
 - 127.0.0.1:18302
Adding slots...
 - 127.0.0.1:18300, 3280
 - 127.0.0.1:18303, 3276
 - 127.0.0.1:18304, 3276
 - 127.0.0.1:18301, 3276
 - 127.0.0.1:18302, 3276
Check cluster state and asign slot...
Ok
create cluster complete.
ec2-user@flashbase:3&gt;
</code></pre>

<ul>
<li>add slave info</li>
</ul>
<p>Open conf file.</p>
<pre><code class="bash">ec2-user@flashbase:3&gt; conf cluster
</code></pre>

<p>You can modify redis.properties by entering the command as shown above.</p>
<pre><code class="bash">#!/bin/bash

## Master hosts and ports
export SR2_REDIS_MASTER_HOSTS=( &quot;127.0.0.1&quot; )
export SR2_REDIS_MASTER_PORTS=( $(seq 18300 18304) )

## Slave hosts and ports (optional)
#export SR2_REDIS_SLAVE_HOSTS=( &quot;127.0.0.1&quot; )
#export SR2_REDIS_SLAVE_PORTS=( $(seq 18600 18609) )

## only single data directory in redis db and flash db
## Must exist below variables; 'SR2_REDIS_DATA', 'SR2_REDIS_DB_PATH' and 'SR2_FLASH_DB_PATH'
#export SR2_REDIS_DATA=&quot;/nvdrive0/nvkvs/redis&quot;
#export SR2_REDIS_DB_PATH=&quot;/nvdrive0/nvkvs/redis&quot;
#export SR2_FLASH_DB_PATH=&quot;/nvdrive0/nvkvs/flash&quot;

## multiple data directory in redis db and flash db
export SSD_COUNT=3
#export HDD_COUNT=3
export SR2_REDIS_DATA=&quot;~/sata_ssd/ssd_&quot;
export SR2_REDIS_DB_PATH=&quot;~/sata_ssd/ssd_&quot;
export SR2_FLASH_DB_PATH=&quot;~/sata_ssd/ssd_&quot;

#######################################################
# Example : only SSD data directory
#export SSD_COUNT=3
#export SR2_REDIS_DATA=&quot;/ssd_&quot;
#export SR2_REDIS_DB_PATH=&quot;/ssd_&quot;
#export SR2_FLASH_DB_PATH=&quot;/ssd_&quot;
#######################################################
</code></pre>

<p>Modify SR2_REDIS_SLAVE_HOSTS and SR2_REDIS_SLAVE_PORTS as shown below.</p>
<pre><code class="bash">#!/bin/bash

## Master hosts and ports
export SR2_REDIS_MASTER_HOSTS=( &quot;127.0.0.1&quot; )
export SR2_REDIS_MASTER_PORTS=( $(seq 18300 18304) )

## Slave hosts and ports (optional)
export SR2_REDIS_SLAVE_HOSTS=( &quot;127.0.0.1&quot; )
export SR2_REDIS_SLAVE_PORTS=( $(seq 18350 18354) )

## only single data directory in redis db and flash db
## Must exist below variables; 'SR2_REDIS_DATA', 'SR2_REDIS_DB_PATH' and 'SR2_FLASH_DB_PATH'
#export SR2_REDIS_DATA=&quot;/nvdrive0/nvkvs/redis&quot;
#export SR2_REDIS_DB_PATH=&quot;/nvdrive0/nvkvs/redis&quot;
#export SR2_FLASH_DB_PATH=&quot;/nvdrive0/nvkvs/flash&quot;

## multiple data directory in redis db and flash db
export SSD_COUNT=3
#export HDD_COUNT=3
export SR2_REDIS_DATA=&quot;~/sata_ssd/ssd_&quot;
export SR2_REDIS_DB_PATH=&quot;~/sata_ssd/ssd_&quot;
export SR2_FLASH_DB_PATH=&quot;~/sata_ssd/ssd_&quot;

#######################################################
# Example : only SSD data directory
#export SSD_COUNT=3
#export SR2_REDIS_DATA=&quot;/ssd_&quot;
#export SR2_REDIS_DB_PATH=&quot;/ssd_&quot;
#export SR2_FLASH_DB_PATH=&quot;/ssd_&quot;
#######################################################
</code></pre>

<p>Save the modification and exit.</p>
<pre><code class="bash">ec2-user@flashbase:3&gt; conf cluster
Check status of hosts...
OK
sync conf
OK
Complete edit
</code></pre>

<ul>
<li>execute command add-slave</li>
</ul>
<pre><code class="bash">ec2-user@flashbase:3&gt; cluster add-slave
Check status of hosts...
OK
Check cluster exist...
 - 127.0.0.1
OK
clean redis conf, node conf, db data of master
clean redis conf, node conf, db data of slave
 - 127.0.0.1
Backup redis slave log in each SLAVE hosts...
 - 127.0.0.1
create redis data directory in each SLAVE hosts
 - 127.0.0.1
sync conf
OK
Starting slave nodes : 127.0.0.1 : 18350|18351|18352|18353|18354 ...
Wait until all redis process up...
cur: 10 / total: 10
Complete all redis process up
replicate [M] 127.0.0.1 18300 - [S] 127.0.0.1 18350
replicate [M] 127.0.0.1 18301 - [S] 127.0.0.1 18351
replicate [M] 127.0.0.1 18302 - [S] 127.0.0.1 18352
replicate [M] 127.0.0.1 18303 - [S] 127.0.0.1 18353
replicate [M] 127.0.0.1 18304 - [S] 127.0.0.1 18354
1 / 5 meet complete.
2 / 5 meet complete.
3 / 5 meet complete.
4 / 5 meet complete.
5 / 5 meet complete.
</code></pre>

<ul>
<li>check configuration information</li>
</ul>
<pre><code class="bash">ec2-user@flashbase:3&gt; cli cluster nodes
0549ec03031213f95121ceff6c9c13800aef848c 127.0.0.1:18303 master - 0 1574132251126 3 connected 3280-6555
1b09519d37ebb1c09095158b4f1c9f318ddfc747 127.0.0.1:18352 slave a6a8013cf0032f0f36baec3162122b3d993dd2c8 0 1574132251025 6 connected
c7dc4815e24054104dff61cac6b13256a84ac4ae 127.0.0.1:18353 slave 0549ec03031213f95121ceff6c9c13800aef848c 0 1574132251126 3 connected
0ab96cb79165ddca7d7134f80aea844bd49ae2e1 127.0.0.1:18351 slave 7e97f8a8799e1e28feee630b47319e6f5e1cfaa7 0 1574132250724 4 connected
7e97f8a8799e1e28feee630b47319e6f5e1cfaa7 127.0.0.1:18301 master - 0 1574132250524 4 connected 9832-13107
e67005a46984445e559a1408dd0a4b24a8c92259 127.0.0.1:18304 master - 0 1574132251126 5 connected 6556-9831
a6a8013cf0032f0f36baec3162122b3d993dd2c8 127.0.0.1:18302 master - 0 1574132251126 2 connected 13108-16383
492cdf4b1dedab5fb94e7129da2a0e05f6c46c4f 127.0.0.1:18350 slave 83b7ef98b80a05a4ee795ae6b399c8cde54ad04e 0 1574132251126 6 connected
f9f7fcee9009f25618e63d2771ee2529f814c131 127.0.0.1:18354 slave e67005a46984445e559a1408dd0a4b24a8c92259 0 1574132250724 5 connected
83b7ef98b80a05a4ee795ae6b399c8cde54ad04e 127.0.0.1:18300 myself,master - 0 1574132250000 1 connected 0-3279

</code></pre>

<p><strong>(10) cluster rowcount</strong></p>
<p>Check the count of records that are stored in the cluster.</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; cluster rowcount
0
</code></pre>

<p><strong>(11) Check status of cluster</strong></p>
<p>With the following commands, you can check the status of the cluster.</p>
<ul>
<li>Send PING</li>
</ul>
<pre><code class="bash">&gt; cli ping --all
</code></pre>

<ul>
<li>Check the status of the cluster</li>
</ul>
<pre><code class="bash">ec2-user@flashbase:1&gt; cli cluster info
cluster_state:ok
cluster_slots_assigned:16384
cluster_slots_ok:16384
cluster_slots_pfail:0
cluster_slots_fail:0
cluster_known_nodes:5
cluster_size:5
cluster_current_epoch:4
cluster_my_epoch:2
cluster_stats_messages_ping_sent:12
cluster_stats_messages_pong_sent:14
cluster_stats_messages_sent:26
cluster_stats_messages_ping_received:10
cluster_stats_messages_pong_received:12
cluster_stats_messages_meet_received:4
cluster_stats_messages_received:26
</code></pre>

<ul>
<li>Check the list of the nodes those are organizing the cluster.</li>
</ul>
<pre><code class="bash">ec2-user@flashbase:1&gt; cli cluster nodes
559af5e90c3f2c92f19c927c29166c268d938e8f 127.0.0.1:18104 master - 0 1574127926000 4 connected 6556-9831
174e2a62722273fb83814c2f12e2769086c3d185 127.0.0.1:18101 myself,master - 0 1574127925000 3 connected 9832-13107
35ab4d3f7f487c5332d7943dbf4b20d5840053ea 127.0.0.1:18100 master - 0 1574127926000 1 connected 0-3279
f39ed05ace18e97f74c745636ea1d171ac1d456f 127.0.0.1:18103 master - 0 1574127927172 0 connected 3280-6555
9fd612b86a9ce1b647ba9170b8f4a8bfa5c875fc 127.0.0.1:18102 master - 0 1574127926171 2 connected 13108-16383
</code></pre>

<h1 id="2-thrift-server-commands">2. Thrift Server Commands<a class="headerlink" href="#2-thrift-server-commands" title="Permanent link">&para;</a></h1>
<p>If you want to see the list of Thrift Server commands, use the 'thriftserver' command without any option.</p>
<pre><code class="bash">NAME
    fbctl thriftserver

SYNOPSIS
    fbctl thriftserver COMMAND

COMMANDS
    COMMAND is one of the following:

     beeline
       Connect to thriftserver command line

     monitor
       Show thriftserver log

     restart
       Thriftserver restart

     start
       Start thriftserver

     stop
       Stop thriftserver
</code></pre>

<p><strong>(1) thriftserver beeline</strong></p>
<p>Connect to the thrift server</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; thriftserver beeline
Connecting...
Connecting to jdbc:hive2://localhost:13000
19/11/19 04:45:18 INFO jdbc.Utils: Supplied authorities: localhost:13000
19/11/19 04:45:18 INFO jdbc.Utils: Resolved authority: localhost:13000
19/11/19 04:45:18 INFO jdbc.HiveConnection: Will try to open client transport with JDBC Uri: jdbc:hive2://localhost:13000
Connected to: Spark SQL (version 2.3.1)
Driver: Hive JDBC (version 1.2.1.spark2)
Transaction isolation: TRANSACTION_REPEATABLE_READ
Beeline version 1.2.1.spark2 by Apache Hive
0: jdbc:hive2://localhost:13000&gt; show tables;
+-----------+------------+--------------+--+
| database  | tableName  | isTemporary  |
+-----------+------------+--------------+--+
+-----------+------------+--------------+--+
No rows selected (0.55 seconds)
</code></pre>

<p>Default value of db url to connect is jdbc:hive2://$HIVE_HOST:$HIVE_PORT</p>
<p>You can modify $HIVE_HOST and $HIVE_PORT by command conf ths</p>
<p><strong>(2) thriftserver monitor</strong></p>
<p>You can view the logs of the thrift server in real time.</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; thriftserver monitor
Press Ctrl-C for exit.
19/11/19 04:43:33 INFO storage.BlockManagerMasterEndpoint: Registering block manager ip-172-31-39-147.ap-northeast-2.compute.internal:35909 with 912.3 MB RAM, BlockManagerId(4, ip-172-31-39-147.ap-northeast-2.compute.internal, 35909, None)
19/11/19 04:43:33 INFO cluster.YarnSchedulerBackend$YarnDriverEndpoint: Registered executor NettyRpcEndpointRef(spark-client://Executor) (172.31.39.147:53604) with ID 5
19/11/19 04:43:33 INFO storage.BlockManagerMasterEndpoint: Registering block manager 
...
</code></pre>

<p><strong>(3) thriftserver restart</strong></p>
<p>Restart the thrift server.</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; thriftserver restart
no org.apache.spark.sql.hive.thriftserver.HiveThriftServer2 to stop
starting org.apache.spark.sql.hive.thriftserver.HiveThriftServer2, logging to /opt/spark/logs/spark-ec2-user-org.apache.spark.sql.hive.thriftserver.HiveThriftServer2-1-ip-172-31-39-147.ap-northeast-2.compute.internal.out
</code></pre>

<p><strong>(4) start thriftserver</strong></p>
<p>Run the thrift server.</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; thriftserver start
starting org.apache.spark.sql.hive.thriftserver.HiveThriftServer2, logging to /opt/spark/logs/spark-ec2-user-org.apache.spark.sql.hive.thriftserver.HiveThriftServer2-1-ip-172-31-39-147.ap-northeast-2.compute.internal.out
</code></pre>

<p>You can view the logs through the command </p>
<p><strong>monitor</strong>.</p>
<p><strong>(5) stop thriftserver</strong></p>
<p>Shut down the thrift server.</p>
<pre><code class="bash">ec2-user@flashbase:1&gt; thriftserver stop
stopping org.apache.spark.sql.hive.thriftserver.HiveThriftServer2
</code></pre>

<p><strong>(6) conf thriftserver</strong></p>
<pre><code class="bash">ec2-user@flashbase:1&gt; conf thriftserver

#!/bin/bash
###############################################################################
# Common variables
SPARK_CONF=${SPARK_CONF:-$SPARK_HOME/conf}
SPARK_BIN=${SPARK_BIN:-$SPARK_HOME/bin}
SPARK_SBIN=${SPARK_SBIN:-$SPARK_HOME/sbin}
SPARK_LOG=${SPARK_LOG:-$SPARK_HOME/logs}

SPARK_METRICS=${SPARK_CONF}/metrics.properties
SPARK_UI_PORT=${SPARK_UI_PORT:-14050}
EXECUTERS=12
EXECUTER_CORES=32

HIVE_METASTORE_URL=''
HIVE_HOST=${HIVE_HOST:-localhost}
HIVE_PORT=${HIVE_PORT:-13000}

COMMON_CLASSPATH=$(find $SR2_LIB -name 'tsr2*' -o -name 'spark-r2*' -o -name '*jedis*' -o -name 'commons*' -o -name 'jdeferred*' \
-o -name 'geospark*' -o -name 'gt-*' | tr '\n' ':')

###############################################################################
# Driver
DRIVER_MEMORY=6g
DRIVER_CLASSPATH=$COMMON_CLASSPATH

###############################################################################
# Execute
EXECUTOR_MEMORY=2g
EXECUTOR_CLASSPATH=$COMMON_CLASSPATH

###############################################################################
# Thrift Server logs
EVENT_LOG_ENABLED=false
EVENT_LOG_DIR=/nvdrive0/thriftserver-event-logs
EVENT_LOG_ROLLING_DIR=/nvdrive0/thriftserver-event-logs-rolling
EVENT_LOG_SAVE_MIN=60
EXTRACTED_EVENT_LOG_SAVE_DAY=5
SPARK_LOG_SAVE_MIN=2000
##############
</code></pre>

<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>If user types 'cfc 1', ${SR2_HOME} will be '~/tsr2/cluster_1/tsr2-assembly-1.0.0-SNAPSHOT'.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../version-update/" class="btn btn-neutral float-right" title="Version update">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../try-with-zeppelin/" class="btn btn-neutral" title="Try out with Zeppelin"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>All right reserved, LightningDB Team.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../try-with-zeppelin/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../version-update/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
